$(document).ready(function () {
	//$("#invoiceReport").hide();
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#loadNonProcessedMemos").click(function () {
		loadNonProcessedMemos();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#showThisMemoInfo").click(function () {

		loadInvoiceData();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#confirmPurchaseReturn").click(function () {
		var a = $.trim($("#sltautoId").text());
		if (a.length > 0) {
			//PUT api/memos/{memoID}/confirmSell
			$.ajax({
				url: "https://localhost:44360/api/memos/" + a + "/SellReturn",
				method: "put",
				headers:
				{
					ContentType: "application/json"
				},

				datatype: JSON,

				complete: function (xmlHttp, status) {
					if (xmlHttp.status == 200) {
						alert("Sells Returned");
						location.reload();
					}
					else {
						$("#updatemsg").html(xmlHttp.status + ":" + xmlHttp.statusText + ":" + xmlHttp.responseText);
					}
				}

			});
			//window.open(url, '_blank');
		}
		else {
			alert("memo Not Loaded");
		}

	})
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	//Load Memo

	$(".table tbody").on("click", ".loadForSelect", function () {
		var currentRow = $(this).closest("tr");
		var col1 = currentRow.find("td:eq(0)").html();
		var col2 = currentRow.find("td:eq(1)").html();
		var col3 = currentRow.find("td:eq(2)").html();
		var col4 = currentRow.find("td:eq(3)").html();
		var col5 = currentRow.find("td:eq(4)").html();
		var col6 = currentRow.find("td:eq(5)").html();

		$("#sltautoId").html(col1);
		$("#sltMemoNumber").html(col2);
		$("#sltMemoDescription").html(col3);
		$("#sltCreatedOn").html(col4);
		$("#sltBelongsTo").html(col5);
		$("#sltStatus").html(col6);
		//alert(col1);

		var element = document.getElementById("sltmemo");
		element.scrollIntoView({
			behavior: "smooth",
			block: "end",
			inline: "nearest",
		});

		//loadInvoiceData();
	});

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->
	//Load non precessed memos in table
	//done
	function loadNonProcessedMemos() {
		//show table
		$("#list1").show(1000);

		$.ajax({
			url: "https://localhost:44360/api/pSellMemos",
			method: "get",
			headers: {
				//Authorization:"Basic "+btoa("admin:123")
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 200) {
					var data = xmlHttp.responseJSON;
					//console(data);
					var str = "";
					for (var i = 0; i < data.length; i++) {
						var start = "<tr><td>";
						var end = "</td></tr>";
						var k = "</td><td>";
						var a1 = data[i].autoId;
						var a2 = data[i].MemoNumber;
						var a3 = data[i].MemoDescription;
						var a4 = data[i].CreatedOn.substr(0, 10);
						var a5 = data[i].BelongsTo;
						var a6 = data[i].Status;

						var action =
							"<button class='btn btn-primary loadForSelect'><i class='fa fa-check' aria-hidden='true'></i></button>";
						//action+="&nbsp;<button class='btn btn-danger loadForDelete'><i class='fa fa-trash' aria-hidden='true'></i></button>";

						str += start + a1 + k + a2 + k + a3 + k + a4 + k + a5 + k + a6 + k + action + end;
					}
					str = str.replace(new RegExp("null", "g"), "-");
					$("#list1 tbody").html(str);

					$("#list1").DataTable();

					var element = document.getElementById("list1");
					element.scrollIntoView({
						behavior: "smooth",
						block: "end",
						inline: "nearest",
					});
				} else {
					$("#msg").html(xmlHttp.status + ":" + xmlHttp.statusText);
				}
			},
		});
	}

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->
	//done *************************************************************************************************************** */
	//Load invoice data in table

	function loadInvoiceData() {
		//show table
		//$("#mainlist").show(1000);
		var memoId = $("#sltautoId").text();
		// endpoint : GET api/memos/{memoID}/purchases
		$.ajax({
			url: "https://localhost:44360/api/memos/" + memoId + "/sells",
			method: "get",
			headers: {
				//Authorization:"Basic "+btoa("admin:123")
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 200) {
					var data = xmlHttp.responseJSON;
					//console(data);
					var str = "";
					var sum = 0;
					for (var i = 0; i < data.length; i++) {
					
						var start = "<tr><td>";
						var end = "</td></tr>";
						var k = "</td><td>";
						var a1 = data[i].PurchaseId;
						var a2 = data[i].MemoNumber;
						var a3 = data[i].ProductId;
						var a4 = data[i].ProductName;
						var a5 = data[i].PurchaseDate;
						if (a5 != null) {
							a5 = data[i].PurchaseDate.substr(0, 10);
						}
						var a6 = data[i].Quantity;
						var a7 = data[i].Price;

						var Qp = a6 * a7;
						sum += Qp;

						str += start + a1 + k + a2 + k + a3 + k + a4 + k + a5 + k + a6 + k + a7 + k + Qp + end;
					}
					//str=str.replace(new RegExp("null", 'g'), "-");
					$("#mainlist tbody").html(str);

					//alert(str);
					//$("#mainlist").DataTable();
					$("#total").text(sum);
					var element = document.getElementById("tbl");
					element.scrollIntoView({
						behavior: "smooth",
						block: "end",
						inline: "nearest",
					});
				} else {
					$("#msg").html(xmlHttp.status + ":" + xmlHttp.statusText);
				}
			},
		});
	}

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

});