$(document).ready(function () {
	//$("#invoiceReport").hide();

	$("#loadNonProcessedMemos").click(function () {
		loadNonProcessedMemos();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#showThisMemoInfo").click(function () {

		loadInvoiceData();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#goToProductSelectionTable").click(function () {
		//Load data

		loadProductSelectionTable();
		//scroll to data table
		var element = document.getElementById("sltmemo");
		element.scrollIntoView({
			behavior: "smooth",
			block: "end",
			inline: "nearest",
		});

		//loadNonProcessedMemos();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#btnUpdate").click(function () {
		updateData();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->

	$("#btnDelete").click(function () {
		deleteData();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->    
	//******************************************************************************************************************************************-->


	$("#addToInvoice").click(function () {
		alert("addToInvoice clicked");
		postData();
	});

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */


	$("#getInvoice").click(function () {
		var a = $.trim($("#sltautoId").text());
		if (a.length > 0) {
			var url = "https://localhost:44360/api/getInvoice/" + a;
			window.open(url, '_blank');
		}
		else {
			alert("memo Not Loaded");
		}

	});

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */


	$("#confirmPurchase").click(function () {
		var a = $.trim($("#sltautoId").text());
		if (a.length > 0) {
			//PUT api/memos/{memoID}/confirmSell
			$.ajax({
				url: "https://localhost:44360/api/memos/" + a + "/confirmPurchase",
				method: "put",
				headers:
				{
					ContentType: "application/json"
				},

				datatype: JSON,

				complete: function (xmlHttp, status) {
					if (xmlHttp.status == 200) {
						alert("Purchase Confirmed");
						//$("#updatemsg").html($("#updProductName").text()+" has Been Successfully Updated");
					}
					else {
						$("#updatemsg").html(xmlHttp.status + ":" + xmlHttp.statusText + ":" + xmlHttp.responseText);
					}
				}

			});
			//window.open(url, '_blank');
		}
		else {
			alert("memo Not Loaded");
		}

	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */


	//Load Memo

	$(".table tbody").on("click", ".loadForSelect", function () {
		var currentRow = $(this).closest("tr");
		var col1 = currentRow.find("td:eq(0)").html();
		var col2 = currentRow.find("td:eq(1)").html();
		var col3 = currentRow.find("td:eq(2)").html();
		var col4 = currentRow.find("td:eq(3)").html();
		var col5 = currentRow.find("td:eq(4)").html();
		var col6 = currentRow.find("td:eq(5)").html();

		$("#sltautoId").html(col1);
		$("#sltMemoNumber").html(col2);
		$("#sltMemoDescription").html(col3);
		$("#sltCreatedOn").html(col4);
		$("#sltBelongsTo").html(col5);
		$("#sltStatus").html(col6);
		//alert(col1);

		var element = document.getElementById("sltmemo");
		element.scrollIntoView({
			behavior: "smooth",
			block: "end",
			inline: "nearest",
		});

		//loadInvoiceData();
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */


	$(".table tbody").on("click", ".loadForSelectProducts", function () {
		var currentRow = $(this).closest("tr");
		var col1 = currentRow.find("td:eq(0)").html();
		var col2 = currentRow.find("td:eq(1)").html();
		var col3 = currentRow.find("td:eq(2)").html();
		var col4 = currentRow.find("td:eq(3)").html();
		var col5 = currentRow.find("td:eq(4)").html();

		$("#slt2ProductId").html(col1);
		$("#slt2ProductName").html(col2);
		$("#slt2ProductDescription").html(col3);
		$("#slt2Quantity").html(col4);
		$("#slt2Price").html(col5);

		var element = document.getElementById("slt2product");
		element.scrollIntoView({
			behavior: "smooth",
			block: "end",
			inline: "nearest",
		});
	});

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */

	$('.table tbody').on('click', '.loadForUpdate', function () {

		var currentRow = $(this).closest("tr");
		var col1 = currentRow.find("td:eq(0)").html();
		var col2 = currentRow.find("td:eq(1)").html();
		var col3 = currentRow.find("td:eq(2)").html();
		var col4 = currentRow.find("td:eq(3)").html();
		var col5 = currentRow.find("td:eq(4)").html();
		var col6 = currentRow.find("td:eq(5)").html();
		var col7 = currentRow.find("td:eq(6)").html();

		$("#updPurchaseId").text(col1);
		$("#updMemoNumber").text(col2);
		$("#updProductId").text(col3);
		$("#updProductName").text(col4);
		$("#updPurchaseDate").text(col5);
		$("#updQuantity").val(col6);
		$("#updPrice").val(col7);


		var element = document.getElementById("upd");
		element.scrollIntoView({ behavior: "smooth", block: "end", inline: "nearest" });
	});

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */

	$('.table tbody').on('click', '.loadForDelete', function () {

		var currentRow = $(this).closest("tr");
		var col1 = currentRow.find("td:eq(0)").html();
		var col2 = currentRow.find("td:eq(1)").html();
		var col3 = currentRow.find("td:eq(2)").html();
		var col4 = currentRow.find("td:eq(3)").html();
		var col5 = currentRow.find("td:eq(4)").html();
		var col6 = currentRow.find("td:eq(5)").html();
		var col7 = currentRow.find("td:eq(6)").html();

		$("#dltPurchaseId").text(col1);
		$("#dltMemoNumber").text(col2);
		$("#dltProductId").text(col3);
		$("#dltProductName").text(col4);
		$("#dltPurchaseDate").text(col5);
		$("#dltQuantity").text(col6);
		$("#dltPrice").text(col7);

		//alert(col1);

		var element = document.getElementById("dlt");
		element.scrollIntoView({ behavior: "smooth", block: "end", inline: "nearest" });
	});
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */
	//Load non precessed memos in table
	//done
	function loadNonProcessedMemos() {
		//show table
		$("#list1").show(1000);

		$.ajax({
			url: "https://localhost:44360/api/npPurchaseMemos",
			method: "get",
			headers: {
				//Authorization:"Basic "+btoa("admin:123")
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 200) {
					var data = xmlHttp.responseJSON;
					//console(data);
					var str = "";
					for (var i = 0; i < data.length; i++) {
						var start = "<tr><td>";
						var end = "</td></tr>";
						var k = "</td><td>";
						var a1 = data[i].autoId;
						var a2 = data[i].MemoNumber;
						var a3 = data[i].MemoDescription;
						var a4 = data[i].CreatedOn.substr(0, 10);
						var a5 = data[i].BelongsTo;
						var a6 = data[i].Status;

						var action =
							"<button class='btn btn-primary loadForSelect'><i class='fa fa-check' aria-hidden='true'></i></button>";
						//action+="&nbsp;<button class='btn btn-danger loadForDelete'><i class='fa fa-trash' aria-hidden='true'></i></button>";

						str +=
							start +
							a1 +
							k +
							a2 +
							k +
							a3 +
							k +
							a4 +
							k +
							a5 +
							k +
							a6 +
							k +
							action +
							end;
					}
					str = str.replace(new RegExp("null", "g"), "-");
					$("#list1 tbody").html(str);

					$("#list1").DataTable();

					var element = document.getElementById("list1");
					element.scrollIntoView({
						behavior: "smooth",
						block: "end",
						inline: "nearest",
					});
				} else {
					$("#msg").html(xmlHttp.status + ":" + xmlHttp.statusText);
				}
			},
		});
	}

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */
	//Load data in table
	//done
	function loadProductSelectionTable() {
		//show table
		$("#list2").show(1000);

		$.ajax({
			url: "https://localhost:44360/api/products",
			method: "get",
			headers: {
				//Authorization:"Basic "+btoa("admin:123")
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 200) {
					var data = xmlHttp.responseJSON;
					//console(data);
					var str = "";
					for (var i = 0; i < data.length; i++) {
						var start = "<tr><td>";
						var end = "</td></tr>";
						var k = "</td><td>";
						var a1 = data[i].ProductId;
						var a2 = data[i].ProductName;
						var a3 = data[i].ProductDescription;
						var a4 = data[i].Quantity;
						var a5 = data[i].Price;
						var a6 = data[i].CreatedDate;
						if (a6 != null) {
							a6 = data[i].CreatedDate.substr(0, 10);
						}

						var a7 = data[i].ModifiedDate;
						if (a7 != null) {
							a7 = data[i].ModifiedDate.substr(0, 10);
						}
						var a8 = data[i].LastPurchasedDate;
						if (a8 != null) {
							a8 = data[i].LastPurchasedDate.substr(0, 10);
						}
						var a9 = data[i].LastSoldDate;
						if (a9 != null) {
							a9 = data[i].LastSoldDate.substr(0, 10);
						}
						var action =
							"<button class='btn btn-primary loadForSelectProducts'><i class='fa fa-plus-square' aria-hidden='true'></i></button>";
						//action+="&nbsp;<button class='btn btn-danger loadForDelete'><i class='fa fa-trash' aria-hidden='true'></i></button>";
						str +=
							start +
							a1 +
							k +
							a2 +
							k +
							a3 +
							k +
							a4 +
							k +
							a5 +
							k +
							a6 +
							k +
							a7 +
							k +
							a8 +
							k +
							a9 +
							k +
							action +
							end;
					}
					str = str.replace(new RegExp("null", "g"), "-");
					$("#list2 tbody").html(str);

					$("#list2").DataTable();

					var element = document.getElementById("list2");
					element.scrollIntoView({
						behavior: "smooth",
						block: "end",
						inline: "nearest",
					});
				} else {
					$("#msg").html(xmlHttp.status + ":" + xmlHttp.statusText);
				}
			},
		});
	}

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */
	//done *************************************************************************************************************** */
	//Load invoice data in table

	function loadInvoiceData() {
		//show table
		//$("#mainlist").show(1000);
		var memoId = $("#sltautoId").text();
		// endpoint : GET api/memos/{memoID}/purchases
		$.ajax({
			url: "https://localhost:44360/api/memos/" + memoId + "/purchases",
			method: "get",
			headers: {
				//Authorization:"Basic "+btoa("admin:123")
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 200) {
					var data = xmlHttp.responseJSON;
					//console(data);
					var str = "";
					for (var i = 0; i < data.length; i++) {
						/* 
									SellId **auto
									MemoNumber  **memotable
									ProductId **productTable
									ProductName <<auto from product ID>> **product Table
									PurchaseDate **current date
									Quantity
									Price
									*/
						var start = "<tr><td>";
						var end = "</td></tr>";
						var k = "</td><td>";
						var a1 = data[i].PurchaseId;
						var a2 = data[i].MemoNumber;
						var a3 = data[i].ProductId;
						var a4 = data[i].ProductName;
						var a5 = data[i].PurchaseDate;
						if (a5 != null) {
							a5 = data[i].PurchaseDate.substr(0, 10);
						}
						var a6 = data[i].Quantity;
						var a7 = data[i].Price;

						var action =
							"<button class='btn btn-primary loadForUpdate'><i class='fa fa-pencil-square' aria-hidden='true'></i></button>";
						action +=
							"&nbsp;<button class='btn btn-danger loadForDelete'><i class='fa fa-trash' aria-hidden='true'></i></button>";
						str +=
							start +
							a1 +
							k +
							a2 +
							k +
							a3 +
							k +
							a4 +
							k +
							a5 +
							k +
							a6 +
							k +
							a7 +
							k +
							action +
							end;
					}
					//str=str.replace(new RegExp("null", 'g'), "-");
					$("#mainlist tbody").html(str);

					//alert(str);
					//$("#mainlist").DataTable();

					var element = document.getElementById("tbl");
					element.scrollIntoView({
						behavior: "smooth",
						block: "end",
						inline: "nearest",
					});
				} else {
					$("#msg").html(xmlHttp.status + ":" + xmlHttp.statusText);
				}
			},
		});
	}

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */
	// POST Information
	function postData() {
		/**
		 * SellId **auto
		  MemoNumber  **memotable
		  ProductId **productTable
		  ProductName <<auto from product ID>> **product Table
		  PurchaseDate **current date
		  Quantity
		  Price
		 */

		// get memo data
		var memoId = $("#sltautoId").text();

		$("#sltMemoNumber").text();
		// $("#sltMemoDescription").text();
		//$("#sltCreatedOn").text();
		// $("#sltBelongsTo").text();
		// $("#sltStatus").text();
		// get product data 
		$("#slt2ProductId").text();
		$("#slt2ProductName").text();
		$("#slt2ProductDescription").text();
		$("#slt2Quantity1").text();
		$("#slt2Price1").text();



		$.ajax({
			url: "https://localhost:44360/api/memos/" + memoId + "/purchases",
			method: "post",
			headers: {
				ContentType: "application/json",
			},

			data: {
				MemoNumber: $("#sltMemoNumber").text(),
				ProductId: $("#slt2ProductId").text(),
				ProductName: $("#slt2ProductName").text(),
				Quantity: $("#slt2Quantity1").val(),
				Price: $("#slt2Price1").val()
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 201) {
					$("#addToInvoicemsg").html($("#slt2ProductId").text() + " Added");

					$("#slt2ProductId").text("");
					$("#slt2ProductName").text("");
					$("#slt2ProductDescription").text("");
					$("#slt2Quantity1").val("");
					$("#slt2Price1").val("");

					$("#slt2Quantity").text("");
					$("#slt2Price").text("");

					loadInvoiceData();
				} else {
					$("#addToInvoicemsg").html(xmlHttp.status + ":" + xmlHttp.statusText + ":" + xmlHttp.responseText);
				}
			},
			success: function () {
				var s = $("#ProductName").val() + "has been inserted successfully";
			},
		});
	}
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */
	//update data
	function updateData() {
		/*
		$("#updSellId").text(col1);
	 $("#updMemoNumber").text(col2);
	 $("#updProductId").text(col3);
	 $("#updProductName").text(col4);
	 $("#updPurchaseDate").text(col5);
	 $("#updQuantity").val(col6);
	 $("#updPrice").val(col7);
		*/
		var memoId = $("#sltautoId").text();
		var PurchaseId = $("#updPurchaseId").text();

		$.ajax({

			url: "https://localhost:44360/api/memos/" + memoId + "/purchases/" + PurchaseId,
			method: "put",
			headers:
			{
				ContentType: "application/json"
			},

			data:
			{
				MemoNumber: $("#updMemoNumber").text(),
				ProductId: $("#updProductId").text(),
				ProductName: $("#updProductName").text(),
				Quantity: $("#updQuantity").val(),
				Price: $("#updPrice").val()
			},
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 200) {
					$("#updatemsg").html($("#updProductName").text() + " has Been Successfully Updated");

					//empty update form
					$("#updPurchaseId").text("");
					$("#updMemoNumber").text("");
					$("#updProductId").text("");
					$("#updProductName").text("");
					$("#updPurchaseDate").text("");
					$("#updQuantity").val("");
					$("#updPrice").val("");

					loadInvoiceData();
				}
				else {
					$("#updatemsg").html(xmlHttp.status + ":" + xmlHttp.statusText + ":" + xmlHttp.responseText);
				}
			}

		});
	}
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */
	function deleteData() {

		var memoId = $("#sltautoId").text();
		var PurchaseId = $("#dltPurchaseId").text();

		var id = $("#dltProductId").html();
		$.ajax({
			url: "https://localhost:44360/api/memos/" + memoId + "/purchases/" + PurchaseId,
			method: "delete",
			complete: function (xmlHttp, status) {
				if (xmlHttp.status == 204) {
					$("#deletemsg").html(id + " has been removed successfully");

					//empty delete form
					$("#dltPurchaseId").text("");
					$("#dltMemoNumber").text("");
					$("#dltProductId").text("");
					$("#dltProductName").text("");
					$("#dltPurchaseDate").text("");
					$("#dltQuantity").text("");
					$("#dltPrice").text("");
					loadInvoiceData();
				}
				else {
					$("#deletemsg").html(xmlHttp.status + ":" + xmlHttp.statusText + ":" + xmlHttp.responseText);
				}
			}
		});
	}

	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//******************************************************************************************************************************************-->
	//*************************************************************************************************************** */

});